# ê¸°ìˆ  ì•„í‚¤í…ì²˜ ë¬¸ì„œ

> ì‚¼ì–‘ íŠ¸ë Œë“œÂ·í¬ë¦¬ì—ì´í„° ì¸ì‚¬ì´íŠ¸ AI ì—ì´ì „íŠ¸ - ê°œë°œì ë° ê¸°ìˆ  ê¸°íšìë¥¼ ìœ„í•œ ì•„í‚¤í…ì²˜ ê°€ì´ë“œ

---

## ëª©ì°¨

- [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
- [ê¸°ìˆ  íë¦„ (Technical Flow)](#ê¸°ìˆ -íë¦„-technical-flow)
- [í•µì‹¬ ëª¨ë“ˆ êµ¬ì¡°](#í•µì‹¬-ëª¨ë“ˆ-êµ¬ì¡°)
- [ë°ì´í„° í”Œë¡œìš°](#ë°ì´í„°-í”Œë¡œìš°)
- [AI/LLM íŒŒì´í”„ë¼ì¸](#aillm-íŒŒì´í”„ë¼ì¸)
- [ì¸ì¦ ë° ê¶Œí•œ ì²´ê³„](#ì¸ì¦-ë°-ê¶Œí•œ-ì²´ê³„)
- [ìºì‹± ì „ëµ](#ìºì‹±-ì „ëµ)
- [ê´€ë ¨ ë¬¸ì„œ](#ê´€ë ¨-ë¬¸ì„œ)

---

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Client Layer                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Dashboard  â”‚  â”‚   Trends    â”‚  â”‚  Creators   â”‚  â”‚   Reports   â”‚    â”‚
â”‚  â”‚   Widget    â”‚  â”‚    Page     â”‚  â”‚    Page     â”‚  â”‚    Page     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                â”‚                â”‚                â”‚            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                          â–¼                â–¼                              â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚              â”‚     React Query (TanStack Query)    â”‚                    â”‚
â”‚              â”‚     - Cache Management              â”‚                    â”‚
â”‚              â”‚     - Query Invalidation            â”‚                    â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           API Layer (Next.js)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     API Routes (/api/*)                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ /trends  â”‚  â”‚/creators â”‚  â”‚ /content â”‚  â”‚   /reports   â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚       â”‚             â”‚             â”‚                â”‚           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚          â–¼             â–¼             â–¼                â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Rate Limit  â”‚  â”‚  Zod Schema  â”‚  â”‚    Logger    â”‚                  â”‚
â”‚  â”‚  (Upstash)   â”‚  â”‚  Validation  â”‚  â”‚              â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                         â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AI Layer    â”‚       â”‚  Database Layer â”‚       â”‚  External APIs  â”‚
â”‚               â”‚       â”‚                 â”‚       â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  OpenAI   â”‚ â”‚       â”‚   â”‚Supabase â”‚   â”‚       â”‚ â”‚ YouTube API â”‚ â”‚
â”‚ â”‚ GPT-4o-   â”‚ â”‚       â”‚   â”‚PostgreSQLâ”‚  â”‚       â”‚ â”‚  Data v3    â”‚ â”‚
â”‚ â”‚   mini    â”‚ â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚       â”‚                 â”‚       â”‚                 â”‚
â”‚               â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚       â”‚   â”‚  Redis  â”‚   â”‚       â”‚ â”‚   SerpAPI   â”‚ â”‚
â”‚ â”‚  Vercel   â”‚ â”‚       â”‚   â”‚(Upstash)â”‚   â”‚       â”‚ â”‚  (backup)   â”‚ â”‚
â”‚ â”‚  AI SDK   â”‚ â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚       â”‚                 â”‚       â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° íë¦„ë„ (Data Flow Diagram)

```mermaid
flowchart TB
    subgraph Client["ğŸ–¥ï¸ Client Layer"]
        UI[React UI Components]
        RQ[React Query Cache]
    end

    subgraph API["âš¡ API Layer (Next.js)"]
        Routes[API Routes]
        Middleware[Rate Limit / Validation]
    end

    subgraph AI["ğŸ¤– AI Layer"]
        TA[Trend Analyzer]
        CM[Creator Matcher]
        CG[Content Generator]
    end

    subgraph DB["ğŸ’¾ Database Layer"]
        Supabase[(Supabase PostgreSQL)]
        Redis[(Upstash Redis)]
    end

    subgraph External["ğŸŒ External APIs"]
        YouTube[YouTube Data API v3]
        SerpAPI[SerpAPI]
    end

    %% Client to API
    UI -->|HTTP Request| Routes
    RQ -->|Cache Management| UI

    %% API Processing
    Routes --> Middleware
    Middleware -->|Validated Request| AI

    %% AI to External
    TA -->|Video Search| YouTube
    TA -.->|Fallback| SerpAPI

    %% AI Processing
    TA -->|GPT-4o-mini| OpenAI((OpenAI))
    CM -->|GPT-4o-mini| OpenAI
    CG -->|GPT-4o-mini| OpenAI

    %% Data Storage
    AI -->|Store Results| Supabase
    AI -->|Log Usage| Supabase
    Routes -->|Cache Check| Redis
    Redis -->|Cached Data| Routes

    %% Response Flow
    Supabase -->|Query Results| Routes
    Routes -->|JSON Response| RQ
```

### ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ (User â†’ System â†’ LLM)

```mermaid
sequenceDiagram
    autonumber
    participant U as ğŸ‘¤ User
    participant UI as ğŸ–¥ï¸ React UI
    participant RQ as ğŸ“¦ React Query
    participant API as âš¡ API Route
    participant RL as ğŸš¦ Rate Limiter
    participant YT as ğŸ“º YouTube API
    participant AI as ğŸ¤– AI Agent
    participant LLM as ğŸ§  GPT-4o-mini
    participant DB as ğŸ’¾ Supabase

    Note over U,DB: íŠ¸ë Œë“œ ë¶„ì„ ìš”ì²­ íë¦„

    U->>UI: í‚¤ì›Œë“œ ì…ë ¥ & ë¶„ì„ ìš”ì²­
    UI->>RQ: useMutation() í˜¸ì¶œ
    RQ->>API: POST /api/trends/analyze

    API->>RL: IP ê¸°ë°˜ Rate Limit ì²´í¬
    alt Rate Limit ì´ˆê³¼
        RL-->>API: 429 Too Many Requests
        API-->>RQ: Error Response
        RQ-->>UI: Error State
        UI-->>U: ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
    else Rate Limit í†µê³¼
        RL-->>API: OK
    end

    API->>YT: ì˜ìƒ ê²€ìƒ‰ (keyword, country)
    YT-->>API: ì˜ìƒ ë©”íƒ€ë°ì´í„° (10ê°œ)

    API->>AI: ìˆ˜ì§‘ëœ ë°ì´í„° ì „ë‹¬
    AI->>LLM: Structured Output ìš”ì²­
    Note right of LLM: System Prompt +<br/>Video Data +<br/>Brand Context

    LLM-->>AI: ë¶„ì„ ê²°ê³¼ (JSON)
    Note right of AI: - ë°”ì´ëŸ´ í¬ë§· ë¶„ì„<br/>- ë¸Œëœë“œ ì—°ê´€ì„± ì ìˆ˜<br/>- ì¶”ì²œ ì œí’ˆ/íƒ€ê²Ÿ

    AI->>DB: ë¶„ì„ ê²°ê³¼ ì €ì¥ (trends í…Œì´ë¸”)
    AI->>DB: API ì‚¬ìš©ëŸ‰ ê¸°ë¡ (api_usage í…Œì´ë¸”)
    DB-->>AI: Insert ì™„ë£Œ

    AI-->>API: ë¶„ì„ ê²°ê³¼ ë°˜í™˜
    API-->>RQ: Success Response
    RQ->>RQ: Cache Invalidation
    RQ-->>UI: Data Update
    UI-->>U: ë¶„ì„ ê²°ê³¼ ì¹´ë“œ í‘œì‹œ
```

---

## ê¸°ìˆ  íë¦„ (Technical Flow)

### 1. íŠ¸ë Œë“œ ë¶„ì„ í”Œë¡œìš°

```
[ì‚¬ìš©ì ì…ë ¥]
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/trends/analyze                                   â”‚
â”‚ Input: { keyword, platform, country }                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Rate Limiter   â”‚            â”‚  Zod Validation â”‚
â”‚  (IP-based)     â”‚            â”‚  Schema Check   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Trend Collector (src/lib/api/trend-collector.ts)          â”‚
â”‚ - YouTube Data API v3 í˜¸ì¶œ                                 â”‚
â”‚ - ì˜ìƒ ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘ (ì œëª©, ì¡°íšŒìˆ˜, ì±„ë„ëª… ë“±)              â”‚
â”‚ - Quota ì‚¬ìš©ëŸ‰ ì¶”ì                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Trend Analyzer (src/lib/ai/agents/trend-analyzer.ts)   â”‚
â”‚ - OpenAI GPT-4o-mini í˜¸ì¶œ                                  â”‚
â”‚ - ë°”ì´ëŸ´ í¬ë§· ë¶„ì„ (POV, Challenge, Reaction ë“±)            â”‚
â”‚ - ì‚¼ì–‘ ë¸Œëœë“œ ì—°ê´€ì„± ì ìˆ˜ ì‚°ì¶œ (0-100)                       â”‚
â”‚ - ì¶”ì²œ ì œí’ˆ, íƒ€ê²Ÿ ì˜¤ë””ì–¸ìŠ¤, ë¦¬ìŠ¤í¬ ë¶„ì„                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database Insert (src/lib/db/queries/trends.ts)            â”‚
â”‚ - Supabase PostgreSQLì— ë¶„ì„ ê²°ê³¼ ì €ì¥                     â”‚
â”‚ - Admin Client ì‚¬ìš© (RLS ìš°íšŒ)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Usage Tracking (src/lib/db/queries/api-usage.ts)      â”‚
â”‚ - YouTube Quota ì‚¬ìš©ëŸ‰ ê¸°ë¡                                â”‚
â”‚ - GPT í† í° ì‚¬ìš©ëŸ‰ ê¸°ë¡                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                 [ì‘ë‹µ ë°˜í™˜]
```

### 2. í¬ë¦¬ì—ì´í„° ë§¤ì¹­ í”Œë¡œìš°

```
[í¬ë¦¬ì—ì´í„° ì •ë³´ ì…ë ¥]
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/creators/match                                   â”‚
â”‚ Input: { username, platform, followerCount, ... }         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Creator Matcher Agent (src/lib/ai/agents/creator-matcher.ts)â”‚
â”‚                                                            â”‚
â”‚ 1. ì •ëŸ‰ì  ë¶„ì„:                                            â”‚
â”‚    - íŒ”ë¡œì›Œ í’ˆì§ˆ ì ìˆ˜                                      â”‚
â”‚    - ì°¸ì—¬ë„ ê°•ë„                                           â”‚
â”‚    - ë„ë‹¬ ì ì¬ë ¥                                           â”‚
â”‚                                                            â”‚
â”‚ 2. ì •ì„±ì  ë¶„ì„:                                            â”‚
â”‚    - ì½˜í…ì¸  ì •ë ¬ë„                                         â”‚
â”‚    - ë¸Œëœë“œ ì•ˆì „ì„±                                         â”‚
â”‚    - ì§„ì •ì„±                                                â”‚
â”‚                                                            â”‚
â”‚ 3. ì¢…í•© ë¸Œëœë“œ ì í•©ë„ ì ìˆ˜ (0-100)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
[DB ì €ì¥ â†’ ì‘ë‹µ ë°˜í™˜]
```

### 3. ì½˜í…ì¸  ì•„ì´ë””ì–´ ìƒì„± í”Œë¡œìš°

```
[ë¸Œëœë“œ/í†¤ì•¤ë§¤ë„ˆ ì„ íƒ]
     â”‚
     â”œâ”€â”€â”€ (ì„ íƒì ) íŠ¸ë Œë“œ ì»¨í…ìŠ¤íŠ¸ ì „ë‹¬
     â”‚    sessionStorage.getItem('trendContext')
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/content/generate                                 â”‚
â”‚ Input: { brandCategory, tone, targetCountry, trendContext }â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Content Generator (src/lib/ai/agents/content-generator.ts) â”‚
â”‚                                                            â”‚
â”‚ - ë¸Œëœë“œë³„ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì ìš©                              â”‚
â”‚ - íŠ¸ë Œë“œ ë¶„ì„ ê²°ê³¼ í™œìš© (ìˆëŠ” ê²½ìš°)                          â”‚
â”‚   - í›„í‚¹ íŒ¨í„´, ë¹„ì£¼ì–¼ íŒ¨í„´, ìŒì•… íŒ¨í„´ ë°˜ì˜                   â”‚
â”‚ - 3ê°œì˜ ë‹¤ì–‘í•œ ì•„ì´ë””ì–´ ë™ì‹œ ìƒì„±                           â”‚
â”‚                                                            â”‚
â”‚ Output per idea:                                           â”‚
â”‚ - title, hook_text, hook_visual                           â”‚
â”‚ - scene_structure (3-5ì»·)                                 â”‚
â”‚ - editing_format, music_style                             â”‚
â”‚ - props_needed, hashtags                                  â”‚
â”‚ - expected_performance                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
[DB ì €ì¥ â†’ ì‘ë‹µ ë°˜í™˜]
```

---

## í•µì‹¬ ëª¨ë“ˆ êµ¬ì¡°

### ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
src/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/                   # ì¸ì¦ ê´€ë ¨ í˜ì´ì§€
â”‚   â”‚   â””â”€â”€ login/
â”‚   â”œâ”€â”€ (dashboard)/              # ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒ ê·¸ë£¹
â”‚   â”‚   â”œâ”€â”€ dashboard/            # ë©”ì¸ ëŒ€ì‹œë³´ë“œ
â”‚   â”‚   â”œâ”€â”€ trends/               # íŠ¸ë Œë“œ ë¶„ì„
â”‚   â”‚   â”œâ”€â”€ creators/             # í¬ë¦¬ì—ì´í„° ë§¤ì¹­
â”‚   â”‚   â”œâ”€â”€ content/              # ì½˜í…ì¸  ì•„ì´ë””ì–´
â”‚   â”‚   â””â”€â”€ reports/              # ë¦¬í¬íŠ¸ ê´€ë¦¬
â”‚   â””â”€â”€ api/                      # API Routes
â”‚       â”œâ”€â”€ trends/
â”‚       â”‚   â”œâ”€â”€ route.ts          # GET: ëª©ë¡, DELETE: ì‚­ì œ
â”‚       â”‚   â”œâ”€â”€ analyze/route.ts  # POST: íŠ¸ë Œë“œ ë¶„ì„
â”‚       â”‚   â””â”€â”€ daily/route.ts    # GET: ë°ì¼ë¦¬ íŠ¸ë Œë“œ
â”‚       â”œâ”€â”€ creators/
â”‚       â”‚   â”œâ”€â”€ route.ts          # GET: ëª©ë¡, DELETE: ì‚­ì œ
â”‚       â”‚   â”œâ”€â”€ match/route.ts    # POST: í¬ë¦¬ì—ì´í„° ë§¤ì¹­
â”‚       â”‚   â””â”€â”€ [id]/route.ts     # GET: ìƒì„¸, PATCH: ìˆ˜ì •
â”‚       â”œâ”€â”€ content/
â”‚       â”‚   â”œâ”€â”€ route.ts          # GET: ëª©ë¡, DELETE: ì‚­ì œ
â”‚       â”‚   â””â”€â”€ generate/route.ts # POST: ì•„ì´ë””ì–´ ìƒì„±
â”‚       â”œâ”€â”€ reports/
â”‚       â”‚   â”œâ”€â”€ route.ts          # GET/POST/DELETE
â”‚       â”‚   â””â”€â”€ export/route.ts   # POST: ë‚´ë³´ë‚´ê¸° (JSON/PDF)
â”‚       â””â”€â”€ usage/route.ts        # GET: API ì‚¬ìš©ëŸ‰ í†µê³„
â”‚
â”œâ”€â”€ lib/                          # í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬
â”‚   â”œâ”€â”€ ai/                       # AI/LLM ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ providers/            # LLM Provider ì„¤ì •
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts          # Provider ì„ íƒ ë¡œì§
â”‚   â”‚   â”‚   â””â”€â”€ openai.ts         # OpenAI í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ agents/               # AI ì—ì´ì „íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ trend-analyzer.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ creator-matcher.ts
â”‚   â”‚   â”‚   â””â”€â”€ content-generator.ts
â”‚   â”‚   â”œâ”€â”€ utils.ts              # ê³µí†µ ìœ í‹¸ (í† í° ë¡œê¹… ë“±)
â”‚   â”‚   â””â”€â”€ token-counter.ts      # í† í° ë¹„ìš© ê³„ì‚°
â”‚   â”‚
â”‚   â”œâ”€â”€ db/                       # ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ server.ts             # Supabase í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”‚   - createServerSupabaseClient() # RLS ì ìš©
â”‚   â”‚   â”‚   - createAdminClient()          # RLS ìš°íšŒ
â”‚   â”‚   â””â”€â”€ queries/              # ì¿¼ë¦¬ í•¨ìˆ˜
â”‚   â”‚       â”œâ”€â”€ trends.ts
â”‚   â”‚       â”œâ”€â”€ creators.ts
â”‚   â”‚       â”œâ”€â”€ content-ideas.ts
â”‚   â”‚       â”œâ”€â”€ reports.ts
â”‚   â”‚       â””â”€â”€ api-usage.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                      # ì™¸ë¶€ API í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ youtube.ts            # YouTube Data API v3
â”‚   â”‚   â”œâ”€â”€ serpapi.ts            # SerpAPI (ë°±ì—…)
â”‚   â”‚   â””â”€â”€ trend-collector.ts    # í†µí•© íŠ¸ë Œë“œ ìˆ˜ì§‘ê¸°
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/                     # ì¸ì¦ ëª¨ë“ˆ
â”‚   â”‚   â””â”€â”€ server.ts             # getServerUser(), getServerSession()
â”‚   â”‚
â”‚   â”œâ”€â”€ cache/                    # ìºì‹± ëª¨ë“ˆ
â”‚   â”‚   â””â”€â”€ redis.ts              # Upstash Redis í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚
â”‚   â””â”€â”€ rate-limit.ts             # Rate Limiting (IP ê¸°ë°˜)
â”‚
â”œâ”€â”€ components/                   # React ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ ui/                       # shadcn/ui ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ dashboard/                # ëŒ€ì‹œë³´ë“œ ìœ„ì ¯
â”‚   â”‚   â”œâ”€â”€ ApiUsageWidget.tsx    # API ì‚¬ìš©ëŸ‰ í‘œì‹œ
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ trends/                   # íŠ¸ë Œë“œ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ creators/                 # í¬ë¦¬ì—ì´í„° ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ content/                  # ì½˜í…ì¸  ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â””â”€â”€ reports/                  # ë¦¬í¬íŠ¸ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚
â”œâ”€â”€ hooks/                        # Custom React Hooks
â”‚   â”œâ”€â”€ useTrends.ts              # íŠ¸ë Œë“œ ë°ì´í„° í›…
â”‚   â”œâ”€â”€ useCreators.ts            # í¬ë¦¬ì—ì´í„° ë°ì´í„° í›…
â”‚   â”œâ”€â”€ useContentIdeas.ts        # ì½˜í…ì¸  ì•„ì´ë””ì–´ í›…
â”‚   â”œâ”€â”€ useReports.ts             # ë¦¬í¬íŠ¸ ë°ì´í„° í›…
â”‚   â””â”€â”€ useApiUsage.ts            # API ì‚¬ìš©ëŸ‰ í›…
â”‚
â””â”€â”€ types/                        # TypeScript íƒ€ì… ì •ì˜
    â”œâ”€â”€ trends.ts
    â”œâ”€â”€ creators.ts
    â”œâ”€â”€ content.ts
    â”œâ”€â”€ reports.ts
    â””â”€â”€ api-usage.ts
```

### ì£¼ìš” ëª¨ë“ˆ ì„¤ëª…

| ëª¨ë“ˆ            | ê²½ë¡œ                  | ì—­í•                                 |
| --------------- | --------------------- | ----------------------------------- |
| **AI Agents**   | `src/lib/ai/agents/`  | GPT-4o-minië¥¼ ì‚¬ìš©í•œ ë¶„ì„/ìƒì„± ë¡œì§ |
| **DB Queries**  | `src/lib/db/queries/` | Supabase CRUD í•¨ìˆ˜ (RLS ê³ ë ¤)       |
| **API Clients** | `src/lib/api/`        | YouTube API, SerpAPI í´ë¼ì´ì–¸íŠ¸     |
| **Hooks**       | `src/hooks/`          | React Query ê¸°ë°˜ ë°ì´í„° í˜ì¹­        |
| **Components**  | `src/components/`     | UI ì»´í¬ë„ŒíŠ¸ (shadcn/ui ê¸°ë°˜)        |

---

## ë°ì´í„° í”Œë¡œìš°

### Supabase í…Œì´ë¸” ê´€ê³„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     users       â”‚
â”‚  (Supabase Auth)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ created_by (FK)
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼          â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ trends  â”‚ â”‚creators â”‚ â”‚content_  â”‚ â”‚ reports â”‚
â”‚         â”‚ â”‚         â”‚ â”‚  ideas   â”‚ â”‚         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                       â”‚
     â”‚ trend_id (FK)         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 api_usage                    â”‚
â”‚  - endpoint: í˜¸ì¶œëœ API ê²½ë¡œ                  â”‚
â”‚  - tokens_used: GPT í† í° ë˜ëŠ” YouTube quota  â”‚
â”‚  - cost: ì˜ˆìƒ ë¹„ìš©                           â”‚
â”‚  - response_time_ms: ì‘ë‹µ ì‹œê°„               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### React Query ìºì‹œ ê´€ë¦¬

```typescript
// Query Key êµ¬ì¡°
['trends', { keyword, platform, country, showAll, ... }]
['creators', { platform, minBrandFitScore, showAll, ... }]
['contentIdeas', { brand_category, tone, showAll, ... }]
['reports', { type, showAll, ... }]
['apiUsage', 'quota']  // API ì‚¬ìš©ëŸ‰ í†µê³„

// ìºì‹œ ë¬´íš¨í™” íŒ¨í„´
queryClient.invalidateQueries({ queryKey: ['trends'] })
// â†’ ëª¨ë“  trends ê´€ë ¨ ìºì‹œ ë¬´íš¨í™” (ì „ì²´/ë‚´ ì‘ì—… ëª¨ë‘)
```

---

## AI/LLM íŒŒì´í”„ë¼ì¸

### Vercel AI SDK ì‚¬ìš©

```typescript
// src/lib/ai/agents/trend-analyzer.ts
import { generateObject } from 'ai';
import { openai } from '@/lib/ai/providers';
import { trendAnalysisSchema } from './schemas';

export async function analyzeTrend(input: TrendAnalysisInput) {
  const result = await generateObject({
    model: openai('gpt-4o-mini'),
    schema: trendAnalysisSchema, // Zod ìŠ¤í‚¤ë§ˆ
    system: TREND_ANALYSIS_SYSTEM_PROMPT,
    prompt: buildUserPrompt(input),
  });

  return result.object; // íƒ€ì… ì•ˆì „í•œ êµ¬ì¡°í™”ëœ ì‘ë‹µ
}
```

### í† í° ì‚¬ìš©ëŸ‰ ì¶”ì 

```typescript
// src/lib/ai/utils.ts
async function logTokenUsage(log: AICallLog) {
  // 1. ì½˜ì†” ë¡œê¹… (ê°œë°œ í™˜ê²½)
  // 2. DB ì €ì¥ (api_usage í…Œì´ë¸”)
  await createAPIUsage({
    endpoint: `ai/${log.model}`,
    tokens_used: log.usage?.totalTokens,
    cost: calculateCost(log.usage, log.model),
    response_time_ms: log.duration,
    status_code: log.success ? 200 : 500,
  });
}
```

### í”„ë¡¬í”„íŠ¸ êµ¬ì¡°

```
prompts/
â”œâ”€â”€ system/
â”‚   â”œâ”€â”€ trend-analyzer.md      # íŠ¸ë Œë“œ ë¶„ì„ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
â”‚   â”œâ”€â”€ creator-matcher.md     # í¬ë¦¬ì—ì´í„° ë§¤ì¹­ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
â”‚   â””â”€â”€ content-generator.md   # ì½˜í…ì¸  ìƒì„± ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
â””â”€â”€ examples/
    â””â”€â”€ few-shot-examples.json # Few-shot í•™ìŠµ ì˜ˆì‹œ
```

---

## ì¸ì¦ ë° ê¶Œí•œ ì²´ê³„

### Supabase í´ë¼ì´ì–¸íŠ¸ ì„ íƒ ê°€ì´ë“œ

| ìƒí™©                 | ì‚¬ìš©í•  í´ë¼ì´ì–¸íŠ¸              | ì´ìœ                      |
| -------------------- | ------------------------------ | ------------------------ |
| ì‚¬ìš©ìë³„ ë°ì´í„° ì¡°íšŒ | `createServerSupabaseClient()` | RLS ì ìš©ìœ¼ë¡œ ìë™ í•„í„°ë§ |
| ì‹œìŠ¤í…œ í†µê³„ ì¡°íšŒ     | `createAdminClient()`          | RLS ìš°íšŒ í•„ìš”            |
| ì‹œìŠ¤í…œ ë°ì´í„° ìƒì„±   | `createAdminClient()`          | ì‚¬ìš©ì ì„¸ì…˜ ì—†ì´ ìƒì„±    |

```typescript
// ì‚¬ìš©ì ë°ì´í„° ì¡°íšŒ (RLS ì ìš©)
const supabase = await createServerSupabaseClient();
const { data } = await supabase.from('trends').select('*').eq('created_by', userId); // RLSê°€ ìë™ìœ¼ë¡œ í•„í„°ë§

// ì‹œìŠ¤í…œ í†µê³„ ì¡°íšŒ (RLS ìš°íšŒ)
const adminClient = createAdminClient();
const { data } = await adminClient.from('api_usage').select('*'); // ëª¨ë“  ë°ì´í„° ì ‘ê·¼ ê°€ëŠ¥
```

### showAll íŒŒë¼ë¯¸í„° ë™ì‘

```typescript
// API Routeì—ì„œì˜ ì²˜ë¦¬
const showAll = searchParams.get('showAll') === 'true';

if (showAll) {
  // ì „ì²´ ë°ì´í„° ì¡°íšŒ (created_by í•„í„° ì—†ìŒ)
  query = supabase.from('trends').select('*');
} else {
  // ë³¸ì¸ ë°ì´í„°ë§Œ ì¡°íšŒ
  query = supabase.from('trends').select('*').eq('created_by', userId);
}
```

---

## ìºì‹± ì „ëµ

### 1. React Query í´ë¼ì´ì–¸íŠ¸ ìºì‹œ

```typescript
// staleTime: ë°ì´í„°ê°€ "ì‹ ì„ "í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼ë˜ëŠ” ì‹œê°„
// API ì‚¬ìš©ëŸ‰: 2ë¶„ (ìì£¼ ë³€ê²½ë¨)
// íŠ¸ë Œë“œ/í¬ë¦¬ì—ì´í„°: 5ë¶„ (ìƒëŒ€ì ìœ¼ë¡œ ì•ˆì •ì )

useQuery({
  queryKey: ['apiUsage', 'quota'],
  queryFn: fetchApiQuota,
  staleTime: 2 * 60 * 1000, // 2ë¶„
});
```

### 2. Redis ìºì‹œ (Upstash)

```typescript
// ë°ì¼ë¦¬ íŠ¸ë Œë“œ: 1ì‹œê°„ ìºì‹±
const cacheKey = `daily-trends:${today}`;
const cached = await redis.get(cacheKey);

if (!cached) {
  const data = await fetchDailyTrends();
  await redis.set(cacheKey, JSON.stringify(data), { ex: 3600 });
}
```

### 3. API Rate Limiting

```typescript
// IP ê¸°ë°˜ Rate Limiting
const rateLimitResult = await rateLimitByIP(ip, {
  max: 10,      // ìµœëŒ€ ìš”ì²­ ìˆ˜
  window: 300,  // 5ë¶„ (300ì´ˆ)
});

// ì‘ë‹µ í—¤ë”
headers: {
  'X-RateLimit-Limit': '10',
  'X-RateLimit-Remaining': '7',
  'X-RateLimit-Reset': '1234567890',
}
```

---

## ê´€ë ¨ ë¬¸ì„œ

| ë¬¸ì„œ                                         | ì„¤ëª…                           |
| -------------------------------------------- | ------------------------------ |
| [PRD.md](PRD.md)                             | í”„ë¡œì íŠ¸ ìš”êµ¬ì‚¬í•­ ë° ë¬¸ì œ ì •ì˜ |
| [TechStack.md](TechStack.md)                 | ê¸°ìˆ  ìŠ¤íƒ ìƒì„¸ ë° ë¹„ìš© ë¶„ì„    |
| [API.md](API.md)                             | API ì—”ë“œí¬ì¸íŠ¸ ìƒì„¸ ë¬¸ì„œ       |
| [Task.md](Task.md)                           | ê°œë°œ ì‘ì—… ê³„íš ë° ì§„í–‰ ìƒí™©    |
| [TroubleShooting.md](TroubleShooting.md)     | ë¬¸ì œ í•´ê²° ê°€ì´ë“œ               |
| [DEPLOYMENT.md](DEPLOYMENT.md)               | ë°°í¬ ê°€ì´ë“œ                    |
| [YOUTUBE_API_SETUP.md](YOUTUBE_API_SETUP.md) | YouTube API ì„¤ì • ê°€ì´ë“œ        |
| [SERPAPI_SETUP.md](SERPAPI_SETUP.md)         | SerpAPI ì„¤ì • ê°€ì´ë“œ            |

---

## ë¹ ë¥¸ ì°¸ì¡°

### í™˜ê²½ ë³€ìˆ˜

```bash
# í•„ìˆ˜
YOUTUBE_API_KEY=
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=
SUPABASE_SERVICE_ROLE_KEY=
DEFAULT_AI_PROVIDER=
OPENAI_API_KEY=
UPSTASH_REDIS_REST_URL=
UPSTASH_REDIS_REST_TOKEN=
LOG_LEVEL=
NEXT_PUBLIC_SENTRY_ENABLED=
SENTRY_ENVIRONMENT=
```

### ìì£¼ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´

```bash
# ê°œë°œ ì„œë²„
pnpm dev

# ë¹Œë“œ
pnpm build

# íƒ€ì… ì²´í¬
pnpm type-check

# ë¦°íŠ¸
pnpm lint
```

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-12-15
